<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>토토디자인 미팅 상담 시트</title>
    <!-- 외부 라이브러리 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, 'Helvetica Neue', 'Segoe UI', 'Apple SD Gothic Neo', 'Noto Sans KR', 'Malgun Gothic', sans-serif;
            background-color: #f8fafc;
        }
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @media print {
            .no-print { display: none !important; }
            body { background-color: white; padding: 0; }
            .print-padding { padding: 0 !important; }
            section, .section-break {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            .max-w-6xl > * {
                page-break-inside: avoid;
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide 아이콘을 React에서 사용하기 위한 컴포넌트
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });
            return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block' }}></i>;
        };

        // 개별 아이콘 컴포넌트 정의
        const User = (p) => <Icon name="user" {...p} />;
        const Phone = (p) => <Icon name="phone" {...p} />;
        const MapPin = (p) => <Icon name="map-pin" {...p} />;
        const Calendar = (p) => <Icon name="calendar" {...p} />;
        const Wallet = (p) => <Icon name="wallet" {...p} />;
        const Users = (p) => <Icon name="users" {...p} />;
        const FileText = (p) => <Icon name="file-text" {...p} />;
        const Trash2 = (p) => <Icon name="trash-2" {...p} />;
        const Wind = (p) => <Icon name="wind" {...p} />;
        const Maximize = (p) => <Icon name="maximize" {...p} />;
        const Utensils = (p) => <Icon name="utensils" {...p} />;
        const Layers = (p) => <Icon name="layers" {...p} />;
        const Bath = (p) => <Icon name="bath" {...p} />;
        const Zap = (p) => <Icon name="zap" {...p} />;
        const Printer = (p) => <Icon name="printer" {...p} />;
        const RotateCcw = (p) => <Icon name="rotate-ccw" {...p} />;
        const Save = (p) => <Icon name="save" {...p} />;
        const Snowflake = (p) => <Icon name="snowflake" {...p} />;
        const Home = (p) => <Icon name="home" {...p} />;
        const ShieldAlert = (p) => <Icon name="shield-alert" {...p} />;
        const ArrowUpSquare = (p) => <Icon name="arrow-up-square" {...p} />;
        const ThermometerSnowflake = (p) => <Icon name="thermometer-snowflake" {...p} />;
        const Briefcase = (p) => <Icon name="briefcase" {...p} />;
        const Box = (p) => <Icon name="box" {...p} />;
        const Scissors = (p) => <Icon name="scissors" {...p} />;
        const Layout = (p) => <Icon name="layout" {...p} />;
        const Target = (p) => <Icon name="target" {...p} />;
        const Building = (p) => <Icon name="building" {...p} />;
        const Settings = (p) => <Icon name="settings" {...p} />;
        const Check = (p) => <Icon name="check" {...p} />;
        const Hammer = (p) => <Icon name="hammer" {...p} />;
        const Lightbulb = (p) => <Icon name="lightbulb" {...p} />;
        const CheckSquare = (p) => <Icon name="check-square" {...p} />;
        const Cpu = (p) => <Icon name="cpu" {...p} />;
        const Columns = (p) => <Icon name="columns" {...p} />;

        const SPACES = ['전체', '거실', '안방', '주방', '현관', '발코니', '드레스룸', '욕실', '기타'];
        const WALLPAPER_TYPES = ['미선택', '일반실크(베스트)', '고급실크(디아망등)', '프리미엄(포티스)', '광폭합지'];

        const InfoItem = ({ icon, label, value }) => (
            <div className="flex items-center gap-3 p-3 rounded-xl bg-slate-50 border border-slate-100">
                <div className="text-slate-400">{icon}</div>
                <div>
                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{label}</p>
                    <p className="text-sm font-black text-slate-800">{value || '---'}</p>
                </div>
            </div>
        );

        const FinishItem = ({ type, title, icon, value, options, detailKey, detailValue, detailOptions, onMainChange, onDetailChange, activeFinishes }) => {
            const showDetail = (type === 'wall' && value === '벽지') || (type === 'ceiling' && value === '벽지') || (type === 'floor' && value !== '미선택' && !['도장'].includes(value));
            
            const getFloorDetailOptions = () => {
                if (value === '장판') return ['보급', '표준', '고급'];
                if (value === '강마루') return ['우드타입', '석재타입'];
                if (value === '원목마루') return ['표준', '고급'];
                return [];
            };

            return (
                <div className="bg-gradient-to-br from-slate-50 to-white p-6 rounded-[2rem] border-2 border-slate-100 shadow-sm hover:shadow-md transition-all">
                    <div className="flex items-center gap-3 mb-4">
                        <div className="w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center text-amber-600">
                            <Icon name={icon} size={20} />
                        </div>
                        <h4 className="text-sm font-black text-slate-800">{title}</h4>
                    </div>
                    
                    <select 
                        className="w-full p-3 bg-white border-2 border-slate-200 rounded-xl text-xs font-black outline-none focus:border-amber-400 transition-all mb-3" 
                        value={value} 
                        onChange={(e) => onMainChange(e.target.value)}
                    >
                        {options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                    </select>

                    {showDetail && (
                        <div className="mt-3 pt-3 border-t border-slate-200">
                            {type === 'floor' ? (
                                <select 
                                    className="w-full p-2.5 bg-amber-50 border border-amber-200 rounded-lg text-[11px] font-black text-amber-700 outline-none" 
                                    value={detailValue || '미선택'} 
                                    onChange={(e) => onDetailChange(e.target.value)}
                                >
                                    {getFloorDetailOptions().length > 0 ? (
                                        getFloorDetailOptions().map(opt => <option key={opt} value={opt}>{opt}</option>)
                                    ) : (
                                        <option value="상담결정">상담 후 결정</option>
                                    )}
                                </select>
                            ) : (
                                <div className="space-y-2">
                                    <p className="text-[10px] font-black text-amber-600 mb-2">도배지 종류</p>
                                    <div className="grid grid-cols-1 gap-1.5">
                                        {detailOptions.map(paper => (
                                            <button
                                                key={paper}
                                                onClick={() => onDetailChange(paper)}
                                                className={`py-2 px-3 rounded-lg text-[10px] font-black border transition-all ${
                                                    detailValue === paper 
                                                        ? 'bg-amber-500 text-white border-amber-500 shadow-sm' 
                                                        : 'bg-white text-slate-500 border-slate-200 hover:border-amber-300'
                                                }`}
                                            >
                                                {paper}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [formData, setFormData] = useState({
                customerName: '',
                contact: '',
                siteName: '',
                area: '',
                workDate: '',
                budget: '',
                familyCount: '',
                consultantName: '',
                residenceStatus: '공실', 
                buildingType: '아파트', 
                residencePurpose: '주거용',
                floorInfo: '', 
                isOuterWall: false, 
                hasElevator: false,
                notes: '',
                scope: '전체',
                demoNotes: '',
                windowBrand: '', 
                extensions: [],
                kitchenAppliances: [],
                kitchenType: [],
                kitchenHardware: '표준', 
                kitchenCountertop: '인조대리석',
                kitchenExtra: '',
                activeFinishSpace: '전체',
                // 마감재 초기화: 모든 공간 미선택으로 설정
                finishesBySpace: SPACES.reduce((acc, s) => ({
                    ...acc, 
                    [s]: { floor: '미선택', floorOption: '미선택', wall: '미선택', wallpaperTypeWall: '미선택', wallpaperTypeCeiling: '미선택', ceiling: '미선택' }
                }), {}),
                publicBath: {
                    tub: '미선택', partition: '미선택', trench: '일반육가', cabinet: '미선택',
                    tileType: '포세린', tileSize: '600*600', ceiling: '미선택', ventFan: '미선택',
                    toilet: '표준형', sink: '표준형', sinkFaucet: '표준형', isSinkFaucetEmbedded: false,
                    tubFaucet: '표준형', isTubFaucetEmbedded: false, showerHead: '표준형', isShowerHeadEmbedded: false,
                    zendai: '표준형'
                },
                masterBath: {
                    tub: '미선택', partition: '미선택', trench: '일반육가', cabinet: '미선택',
                    tileType: '포세린', tileSize: '600*600', ceiling: '미선택', ventFan: '미선택',
                    toilet: '표준형', sink: '표준형', sinkFaucet: '표준형', isSinkFaucetEmbedded: false,
                    tubFaucet: '표준형', isTubFaucetEmbedded: false, showerHead: '표준형', isShowerHeadEmbedded: false,
                    zendai: '표준형'
                },
                activeSpace: '전체',
                furnitureBySpace: SPACES.reduce((acc, s) => ({ ...acc, [s]: [] }), {}),
                activeDetailSpace: '전체',
                detailsBySpace: SPACES.reduce((acc, s) => ({
                    ...acc, [s]: { lighting: [], electrical: [], carpentry: [], lightingLocations: {} }
                }), {}),
                doorDetailsBySpace: SPACES.reduce((acc, s) => ({
                    ...acc, [s]: { 
                        doorStyle: '미선택', 
                        doorHandle: '일반', 
                        moldingType: '미선택',
                        skirtingType: '미선택',
                        entranceDoor: '미선택'
                    }
                }), {}),
                systemHangerInfo: '',
                airconType: '시스템에어컨',
                airconBrand: 'LG',
                airconCount: 0,
                airconLocation: ''
            });
            const activeFinishes = formData.finishesBySpace[formData.activeFinishSpace];
            const wallIsPaper = activeFinishes?.wall === '벽지';
            const ceilingIsPaper = activeFinishes?.ceiling === '벽지';

            const handleInputChange = (e) => {
                const { name, value, type, checked } = e.target;
                setFormData(prev => ({ ...prev, [name]: type === 'checkbox' ? checked : value }));
            };

            const toggleArrayItem = (listName, item) => {
                setFormData(prev => ({
                    ...prev,
                    [listName]: prev[listName].includes(item) ? prev[listName].filter(i => i !== item) : [...prev[listName], item]
                }));
            };

            const handleFinishChange = (key, value) => {
                const space = formData.activeFinishSpace;
                setFormData(prev => {
                    const currentSpace = prev.finishesBySpace[space] || {};
                    return {
                        ...prev,
                        finishesBySpace: {
                            ...prev.finishesBySpace,
                            [space]: { ...currentSpace, [key]: value }
                        }
                    };
                });
            };

            const toggleFurnitureForSpace = (item) => {
                const space = formData.activeSpace;
                setFormData(prev => ({
                    ...prev,
                    furnitureBySpace: {
                        ...prev.furnitureBySpace,
                        [space]: prev.furnitureBySpace[space].includes(item) ? prev.furnitureBySpace[space].filter(i => i !== item) : [...prev.furnitureBySpace[space], item]
                    }
                }));
            };

            const toggleDetailForSpace = (category, item) => {
                const space = formData.activeDetailSpace;
                setFormData(prev => {
                    const currentSpace = prev.detailsBySpace[space] || { lighting: [], electrical: [], carpentry: [], lightingLocations: {} };
                    const currentArray = currentSpace[category] || [];
                    const isArray = Array.isArray(currentArray);
                    
                    return {
                        ...prev,
                        detailsBySpace: {
                            ...prev.detailsBySpace,
                            [space]: {
                                ...currentSpace,
                                [category]: isArray && currentArray.includes(item)
                                    ? currentArray.filter(i => i !== item)
                                    : isArray
                                    ? [...currentArray, item]
                                    : [item]
                            }
                        }
                    };
                });
            };

            const handleDetailLocationChange = (item, value) => {
                const space = formData.activeDetailSpace;
                setFormData(prev => ({
                    ...prev,
                    detailsBySpace: {
                        ...prev.detailsBySpace,
                        [space]: {
                            ...prev.detailsBySpace[space],
                            lightingLocations: { ...prev.detailsBySpace[space].lightingLocations, [item]: value }
                        }
                    }
                }));
            };

            const handleBathChange = (type, key, value) => {
                setFormData(prev => ({ ...prev, [type]: { ...prev[type], [key]: value } }));
            };

            const handlePrint = () => window.print();
            const resetForm = () => { if (window.confirm("시트를 초기화하시겠습니까?")) window.location.reload(); };

            const renderBathSection = (type, title, bgColor, borderColor, textColor) => (
                <div className={`${bgColor} p-6 md:p-8 rounded-[2.5rem] border-2 ${borderColor} relative overflow-hidden group shadow-sm`}>
                    <div className={`absolute top-0 right-0 p-4 opacity-5 group-hover:scale-110 transition-transform ${textColor}`}><Icon name="bath" size={160} /></div>
                    <h3 className={`font-black ${textColor} mb-6 text-xl relative flex items-center gap-2`}><span className={`w-3 h-3 rounded-full bg-current`}></span> {title}</h3>
                    
                    <div className="grid grid-cols-1 gap-8 relative font-bold">
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-6 font-bold">
                            <div className="space-y-4">
                                <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">욕조 옵션</label>
                                    <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none" value={formData[type].tub} onChange={(e) => handleBathChange(type, 'tub', e.target.value)}>
                                        <option value="미선택">욕조 미선택</option><option value="일반욕조">일반 욕조</option><option value="조적욕조">조적 욕조</option><option value="이동식욕조">이동식 욕조</option>
                                    </select>
                                </div>
                                <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">파티션 옵션</label>
                                    <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none" value={formData[type].partition} onChange={(e) => handleBathChange(type, 'partition', e.target.value)}>
                                        <option value="미선택">파티션 미선택</option><option value="강화유리">강화유리</option><option value="조적">조적</option><option value="조적(하프)">조적(하프)</option><option value="조적(하프)+강화유리">조적(하프)+유리</option>
                                    </select>
                                </div>
                                <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">수납장 형태</label>
                                    <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none" value={formData[type].cabinet} onChange={(e) => handleBathChange(type, 'cabinet', e.target.value)}>
                                        <option value="미선택">미선택</option><option value="슬라이딩장">슬라이딩장</option><option value="장거울통일">장거울통일</option><option value="장거울따로">장거울따로</option><option value="여닫이장">여닫이장</option><option value="플랩장">플랩장</option>
                                    </select>
                                </div>
                            </div>
                            <div className="space-y-4">
                                <div className="grid grid-cols-2 gap-2">
                                    <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">타일 종류</label>
                                        <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none font-bold" value={formData[type].tileType} onChange={(e) => handleBathChange(type, 'tileType', e.target.value)}>
                                            <option value="포세린">포세린</option><option value="세라믹">세라믹</option>
                                        </select>
                                    </div>
                                    <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1">타일 사이즈</label>
                                        <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none font-bold" value={formData[type].tileSize} onChange={(e) => handleBathChange(type, 'tileSize', e.target.value)}>
                                            <option value="600*600">600*600</option><option value="600*1200">600*1200</option><option value="300*600">300*600</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-2">
                                    <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1 font-bold">천장</label>
                                        <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none font-bold" value={formData[type].ceiling} onChange={(e) => handleBathChange(type, 'ceiling', e.target.value)}>
                                            <option value="미선택">미선택</option><option value="SMC">SMC</option><option value="PVC 돔">PVC 돔</option><option value="이노솔">이노솔</option><option value="간접조명">간접조명</option>
                                        </select>
                                    </div>
                                    <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1 font-bold">환풍기</label>
                                        <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none font-bold" value={formData[type].ventFan} onChange={(e) => handleBathChange(type, 'ventFan', e.target.value)}>
                                            <option value="미선택">미선택</option><option value="표준">표준형</option><option value="고급">고급형</option>
                                        </select>
                                    </div>
                                </div>
                                <div><label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-1 font-bold">육가 옵션</label>
                                    <select className="w-full p-3 text-sm bg-white border border-slate-200 rounded-xl outline-none font-bold" value={formData[type].trench} onChange={(e) => handleBathChange(type, 'trench', e.target.value)}>
                                        <option value="일반육가">일반 육가</option><option value="트렌치육가">트렌치 육가</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white/60 p-5 md:p-6 rounded-[2rem] border border-slate-100 shadow-sm">
                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] border-b pb-2 mb-5">Fitting & Faucet 기구 및 수전 사양</p>
                            <div className="space-y-4">
                                {[
                                    { label: '양변기', key: 'toilet', hasEmbed: false },
                                    { label: '세면대', key: 'sink', hasEmbed: false },
                                    { label: '세면수전', key: 'sinkFaucet', hasEmbed: true, embedKey: 'isSinkFaucetEmbedded' },
                                    { label: '욕조수전', key: 'tubFaucet', hasEmbed: true, embedKey: 'isTubFaucetEmbedded' },
                                    { label: '샤워기(슬바)', key: 'showerHead', hasEmbed: true, embedKey: 'isShowerHeadEmbedded' },
                                    { label: '젠다이', key: 'zendai', hasEmbed: false }
                                ].map((item) => (
                                    <div key={item.key} className="flex flex-col sm:flex-row sm:items-center justify-between gap-3 py-2.5 border-b border-slate-50 last:border-0">
                                        <div className="flex items-center gap-2 min-w-[100px]">
                                            <span className="text-[13px] font-black text-slate-700">{item.label}</span>
                                        </div>
                                        
                                        <div className="flex flex-wrap items-center gap-4">
                                            <div className="flex gap-1.5 p-1 bg-slate-100 rounded-xl font-bold">
                                                {['표준형', '고급형'].map(opt => (
                                                    <button
                                                        key={opt}
                                                        onClick={() => handleBathChange(type, item.key, opt)}
                                                        className={`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all ${
                                                            formData[type][item.key] === opt 
                                                            ? 'bg-white text-slate-900 shadow-sm' 
                                                            : 'text-slate-400 hover:text-slate-600'
                                                        }`}
                                                    >
                                                        {opt}
                                                    </button>
                                                ))}
                                            </div>

                                            {item.hasEmbed && (
                                                <label className="flex items-center gap-2 cursor-pointer group px-2">
                                                    <div className={`w-4 h-4 rounded border-2 flex items-center justify-center transition-all ${
                                                        formData[type][item.embedKey] ? 'bg-indigo-500 border-indigo-500' : 'bg-white border-slate-200'
                                                    }`}>
                                                        {formData[type][item.embedKey] && <div className="w-1.5 h-1.5 bg-white rounded-full"></div>}
                                                    </div>
                                                    <input 
                                                        type="checkbox" 
                                                        className="hidden" 
                                                        checked={formData[type][item.embedKey]} 
                                                        onChange={(e) => handleBathChange(type, item.embedKey, e.target.checked)} 
                                                    />
                                                    <span className={`text-[11px] font-black ${formData[type][item.embedKey] ? 'text-indigo-600' : 'text-slate-400 group-hover:text-slate-600'}`}>매립형</span>
                                                </label>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen p-4 md:p-8 print:p-0">
                    <div className="max-w-6xl mx-auto space-y-6">
                        
                        <div className="flex justify-end gap-3 no-print">
                            <button onClick={resetForm} className="flex items-center gap-2 px-4 py-2 text-slate-400 hover:text-rose-500 transition-colors font-bold"><Icon name="rotate-ccw" size={18} /><span>초기화</span></button>
                            <button onClick={handlePrint} className="flex items-center gap-2 bg-slate-900 text-white px-7 py-3 rounded-2xl hover:bg-slate-800 shadow-xl transition-all font-bold"><Icon name="printer" size={18} /><span>PDF 저장 / 인쇄</span></button>
                        </div>

                        <header className="bg-white p-8 md:p-12 rounded-[3rem] shadow-sm border border-slate-100 relative overflow-hidden section-break">
                            <div className="absolute top-0 right-0 p-12 opacity-[0.03] rotate-12"><Icon name="home" size={240} /></div>
                            
                            <div className="relative z-10 flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-6">
                                <div>
                                    <h1 className="text-4xl font-black tracking-tight text-slate-900 mb-2">토토디자인 미팅 시트</h1>
                                    <div className="flex items-center gap-3">
                                        <span className="h-[2px] w-8 bg-blue-500"></span>
                                        <p className="text-slate-400 font-bold tracking-[0.3em] uppercase text-[10px]">TOTODESIGN INTERIOR STUDIO</p>
                                    </div>
                                </div>
                                <div className="flex flex-col items-end gap-3">
                                    <div className="px-4 py-1.5 bg-slate-100 rounded-full text-[10px] font-black text-slate-500 uppercase tracking-widest">Counseling Sheet</div>
                                    <div className="flex items-center gap-3 bg-slate-50 p-2 pl-4 rounded-2xl border border-slate-100 print:hidden">
                                        <Icon name="briefcase" size={14} className="text-slate-400" />
                                        <input type="text" name="consultantName" value={formData.consultantName} onChange={handleInputChange} placeholder="상담자 성함" className="bg-transparent border-0 text-xs font-black outline-none focus:ring-0 w-32" />
                                    </div>
                                    <p className="hidden print:block text-xs font-black text-slate-400">Counselor: {formData.consultantName || '---'}</p>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-5 relative z-10">
                                {[
                                    { label: '고객명', name: 'customerName', icon: 'user' },
                                    { label: '연락처', name: 'contact', icon: 'phone' },
                                    { label: '현장명', name: 'siteName', icon: 'map-pin' },
                                    { label: '공사일정', name: 'workDate', icon: 'calendar', type: 'date' },
                                    { label: '예산(만원)', name: 'budget', icon: 'wallet', type: 'number' },
                                    { label: '가족인원', name: 'familyCount', icon: 'users', type: 'number' }
                                ].map(f => (
                                    <div key={f.name} className="group relative bg-slate-50/50 rounded-2xl border border-transparent focus-within:border-blue-200 focus-within:bg-white transition-all p-4">
                                        <div className="flex items-center gap-3 mb-1">
                                            <Icon name={f.icon} size={14} className="text-slate-300 group-focus-within:text-blue-500 transition-colors" />
                                            <span className="text-[9px] font-black text-slate-400 uppercase tracking-wider">{f.label}</span>
                                        </div>
                                        <div className="relative">
                                            <input type={f.type || 'text'} name={f.name} value={formData[f.name]} onChange={handleInputChange} className="w-full bg-transparent outline-none text-sm font-black text-slate-800" />
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-6 font-bold relative z-10">
                                <div className="group relative bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-100 hover:border-blue-200 focus-within:border-blue-300 focus-within:bg-white transition-all p-5 shadow-sm">
                                    <div className="flex items-center gap-3 mb-2">
                                        <div className="w-8 h-8 bg-blue-100 rounded-xl flex items-center justify-center">
                                            <Home size={16} className="text-blue-600" />
                                        </div>
                                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-wider">평수</span>
                                    </div>
                                    <div className="relative">
                                        <input type="number" name="area" value={formData.area} onChange={handleInputChange} placeholder="00" className="w-full bg-transparent outline-none text-lg font-black text-slate-800" />
                                        <span className="absolute right-0 top-0 text-sm font-black text-slate-400">평</span>
                                    </div>
                                </div>
                                
                                <div className="bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-100 shadow-sm p-5">
                                    <div className="flex items-center gap-2 mb-3">
                                        <div className="w-8 h-8 bg-amber-100 rounded-xl flex items-center justify-center">
                                            <Target size={16} className="text-amber-600" />
                                        </div>
                                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-wider">공사 목적</span>
                                    </div>
                                    <div className="flex flex-wrap gap-3">
                                        {['주거용', '매매계획', '임대용'].map(p => (
                                            <label key={p} className="flex items-center gap-2 cursor-pointer group">
                                                <div className={`w-4 h-4 rounded-full border-2 flex items-center justify-center transition-all ${
                                                    formData.residencePurpose === p 
                                                        ? 'bg-blue-500 border-blue-500' 
                                                        : 'bg-white border-slate-300 group-hover:border-blue-300'
                                                }`}>
                                                    {formData.residencePurpose === p && <div className="w-2 h-2 bg-white rounded-full"></div>}
                                                </div>
                                                <input type="radio" name="residencePurpose" value={p} checked={formData.residencePurpose === p} onChange={handleInputChange} className="hidden" />
                                                <span className={`text-xs font-black transition-colors ${formData.residencePurpose === p ? 'text-blue-700' : 'text-slate-500 group-hover:text-slate-700'}`}>{p}</span>
                                            </label>
                                        ))}
                                    </div>
                                </div>
                                
                                <div className="bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-100 shadow-sm p-5">
                                    <div className="flex items-center gap-2 mb-3">
                                        <div className="w-8 h-8 bg-purple-100 rounded-xl flex items-center justify-center">
                                            <Building size={16} className="text-purple-600" />
                                        </div>
                                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-wider">유형 & 층수</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <select name="buildingType" value={formData.buildingType} onChange={handleInputChange} className="flex-1 bg-white border border-slate-200 rounded-lg px-3 py-2 text-xs font-black text-slate-700 outline-none focus:border-purple-400 transition-colors">
                                            {['아파트', '주택', '빌라', '상가', '기타'].map(type => (<option key={type} value={type}>{type}</option>))}
                                        </select>
                                        <div className="flex items-center gap-1 bg-white border border-slate-200 rounded-lg px-2 py-2">
                                            <input type="text" name="floorInfo" value={formData.floorInfo} onChange={handleInputChange} placeholder="00" className="w-10 bg-transparent text-xs font-black text-purple-600 text-center outline-none" />
                                            <span className="text-xs font-black text-purple-600">(층)</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="bg-gradient-to-br from-slate-50 to-white rounded-2xl border-2 border-slate-100 shadow-sm p-5">
                                    <div className="flex items-center gap-2 mb-3">
                                        <div className="w-8 h-8 bg-green-100 rounded-xl flex items-center justify-center">
                                            <Settings size={16} className="text-green-600" />
                                        </div>
                                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-wider">옵션</span>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="flex items-center gap-2 cursor-pointer group p-2 rounded-lg hover:bg-slate-50 transition-colors">
                                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${
                                                formData.hasElevator 
                                                    ? 'bg-blue-500 border-blue-500' 
                                                    : 'bg-white border-slate-300 group-hover:border-blue-300'
                                            }`}>
                                                {formData.hasElevator && <Check size={12} className="text-white" />}
                                            </div>
                                            <input type="checkbox" name="hasElevator" checked={formData.hasElevator} onChange={handleInputChange} className="hidden" />
                                            <div className="flex items-center gap-2">
                                                <ArrowUpSquare size={14} className={formData.hasElevator ? "text-blue-500" : "text-slate-300"} />
                                                <span className={`text-xs font-black ${formData.hasElevator ? 'text-blue-600' : 'text-slate-400'}`}>엘리베이터</span>
                                            </div>
                                        </label>
                                        <label className="flex items-center gap-2 cursor-pointer group p-2 rounded-lg hover:bg-slate-50 transition-colors">
                                            <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${
                                                formData.isOuterWall 
                                                    ? 'bg-red-500 border-red-500' 
                                                    : 'bg-white border-slate-300 group-hover:border-red-300'
                                            }`}>
                                                {formData.isOuterWall && <Check size={12} className="text-white" />}
                                            </div>
                                            <input type="checkbox" name="isOuterWall" checked={formData.isOuterWall} onChange={handleInputChange} className="hidden" />
                                            <div className="flex items-center gap-2">
                                                <ThermometerSnowflake size={14} className={formData.isOuterWall ? "text-red-500" : "text-slate-300"} />
                                                <span className={`text-xs font-black ${formData.isOuterWall ? 'text-red-600' : 'text-slate-400'}`}>외벽 라인</span>
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div className="mt-5 relative font-bold">
                                <textarea name="notes" value={formData.notes} onChange={handleInputChange} placeholder="기타 특이사항" className="w-full p-5 bg-slate-50 border-2 border-transparent rounded-[1.5rem] h-20 focus:border-blue-500 focus:bg-white outline-none transition-all font-medium text-sm font-sans" />
                            </div>
                        </header>

                        <section className="bg-white p-6 md:p-8 rounded-3xl shadow-sm border-l-8 border-slate-900 font-bold section-break">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4 font-sans font-bold">
                                <h3 className="font-black text-slate-900 text-xl flex items-center gap-2"><Trash2 size={24} /> 철거 및 공사 범위</h3>
                                <div className="flex gap-2">
                                    {['전체', '부분'].map(s => (<button key={s} onClick={() => setFormData(p => ({...p, scope: s}))} className={`px-8 py-2 rounded-xl font-black transition-all border-2 ${formData.scope === s ? 'bg-slate-900 border-slate-900 text-white shadow-md' : 'bg-slate-50 border-transparent text-slate-400'}`}>{s}</button>))}
                                </div>
                            </div>
                            <textarea name="demoNotes" value={formData.demoNotes} onChange={handleInputChange} placeholder="구체적인 철거 범위 기입" className="w-full p-5 bg-slate-50 border border-slate-100 rounded-[1.5rem] h-32 focus:bg-white outline-none text-sm font-medium font-sans" />
                        </section>

                        <section className="bg-white p-6 md:p-8 rounded-3xl shadow-sm border-l-8 border-cyan-400 font-bold section-break">
                            <h3 className="font-black text-cyan-600 mb-6 flex items-center gap-2 text-xl tracking-tight"><Snowflake size={24} /> 냉방 가전 계획</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 font-sans">
                                <div className="space-y-4">
                                    <div className="flex gap-2 font-bold font-sans">
                                        {['시스템에어컨', '스탠드/벽걸이'].map(type => (
                                            <button key={type} onClick={() => setFormData(prev => ({ ...prev, airconType: type }))} className={`flex-1 py-3 rounded-xl font-black transition-all border-2 ${formData.airconType === type ? 'bg-cyan-500 border-cyan-500 text-white shadow-md' : 'bg-slate-50 border-transparent text-slate-400 font-sans'}`}>{type}</button>
                                        ))}
                                    </div>
                                    {formData.airconType === '시스템에어컨' ? (
                                        <div className="grid grid-cols-2 gap-3 font-sans font-bold">
                                            <select className="p-3 bg-slate-50 border border-slate-100 rounded-xl outline-none font-black text-xs" value={formData.airconBrand} onChange={(e) => setFormData(prev => ({...prev, airconBrand: e.target.value}))}><option value="LG">LG 전자</option><option value="삼성">삼성 전자</option></select>
                                            <input type="number" placeholder="대수" className="p-3 bg-slate-50 border border-slate-100 rounded-xl outline-none font-black text-xs text-center font-bold font-sans" value={formData.airconCount} onChange={(e) => setFormData(prev => ({...prev, airconCount: e.target.value}))} />
                                        </div>
                                    ) : (
                                        <div className="bg-cyan-50 p-4 rounded-2xl text-[10px] text-cyan-700 font-bold leading-relaxed border border-cyan-100 tracking-tighter">* 배관 매립 시 가격 변동 가능성 있음 ▽</div>
                                    )}
                                </div>
                                <textarea className="w-full p-5 bg-slate-50 border border-slate-100 rounded-[1.5rem] h-24 outline-none text-sm font-medium focus:bg-white focus:border-cyan-400 transition-all font-sans font-bold" placeholder="설치 위치 상세" value={formData.airconLocation} onChange={(e) => setFormData(prev => ({...prev, airconLocation: e.target.value}))} />
                            </div>
                        </section>

                        {/* 창호 및 확장 공사 */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 font-sans font-bold section-break">
                            <div className="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-blue-500">
                                <h3 className="font-black text-blue-600 mb-5 flex items-center gap-2 text-lg"><Wind size={20} /> 창호 브랜드</h3>
                                <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                    {[{ name: 'LX하우시스', sub: '20%▲' }, { name: '이건창호', sub: '10%▲' }, { name: 'KCC', sub: '표준' }].map(brand => (
                                        <button
                                            key={brand.name}
                                            onClick={() => setFormData(p => ({ ...p, windowBrand: brand.name }))}
                                            className={`w-full p-4 rounded-2xl text-left border-2 transition-all flex flex-col items-center justify-center ${
                                                formData.windowBrand === brand.name
                                                    ? 'border-blue-500 bg-blue-50'
                                                    : 'bg-slate-50 border-transparent hover:border-blue-200'
                                            }`}
                                        >
                                            <span className="font-black text-sm">{brand.name}</span>
                                            {brand.sub && <span className="text-[10px] font-bold text-slate-400 mt-1">{brand.sub}</span>}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-orange-500">
                                <h3 className="font-black text-orange-600 mb-5 flex items-center gap-2 text-lg"><Maximize size={20} /> 확장 공사</h3>
                                <div className="grid grid-cols-3 gap-2">
                                    {['거실', '주방', '안방', '침실1', '침실2', '발코니'].map(room => (
                                        <label
                                            key={room}
                                            className={`flex items-center justify-center p-3 border-2 rounded-2xl cursor-pointer transition-all ${
                                                formData.extensions.includes(room)
                                                    ? 'bg-orange-50 border-orange-200 text-orange-700 shadow-sm'
                                                    : 'bg-slate-50 border-transparent text-slate-400'
                                            }`}
                                        >
                                            <input
                                                type="checkbox"
                                                checked={formData.extensions.includes(room)}
                                                onChange={() => toggleArrayItem('extensions', room)}
                                                className="hidden"
                                            />
                                            <span className="text-xs font-black">{room}</span>
                                        </label>
                                    ))}
                                </div>
                            </div>
                        </div>

                        <div className="bg-white p-6 md:p-8 rounded-3xl shadow-sm border-l-8 border-teal-500 font-bold section-break">
                            <h3 className="font-black text-teal-600 mb-6 flex items-center gap-2 text-xl tracking-tight"><Utensils size={24} /> 주방 사양</h3>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                                <div className="font-sans">
                                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest border-b pb-2 mb-4">빌트인 가전</p>
                                    <div className="space-y-3 font-bold">
                                        {['키친핏 냉장고', '인덕션', '빌트인 후드', '식기세척기', '냉온정수기'].map(item => (
                                            <label key={item} className="flex items-center gap-3 cursor-pointer group"><input type="checkbox" className="w-4 h-4 rounded text-teal-600 font-sans" checked={formData.kitchenAppliances.includes(item)} onChange={() => toggleArrayItem('kitchenAppliances', item)}/><span className="text-xs font-black text-slate-600 group-hover:text-teal-600 transition-colors">{item}</span></label>
                                        ))}
                                    </div>
                                </div>
                                <div className="font-sans">
                                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest border-b pb-2 mb-4">Layout & HW</p>
                                    <div className="mb-4">
                                        <p className="text-[9px] font-black text-slate-500 uppercase tracking-wider mb-2">Layout (레이아웃)</p>
                                        <div className="grid grid-cols-2 gap-2">
                                            {['일반형', 'ㄱ자형', '아일랜드', '대면형'].map(type => (
                                                <button 
                                                    key={type} 
                                                    onClick={() => toggleArrayItem('kitchenType', type)} 
                                                    className={`py-2.5 rounded-lg text-[10px] font-black border-2 transition-all font-sans font-bold ${
                                                        formData.kitchenType.includes(type) 
                                                            ? 'bg-teal-500 text-white border-teal-500 shadow-md' 
                                                            : 'bg-slate-50 text-slate-400 border-slate-200 hover:border-teal-300'
                                                    }`}
                                                >
                                                    {type}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <p className="text-[9px] font-black text-slate-500 uppercase tracking-wider mb-2">하드웨어</p>
                                        <select className="w-full p-3 bg-slate-50 border border-slate-100 rounded-xl text-xs font-black outline-none font-sans font-bold" value={formData.kitchenHardware} onChange={(e) => setFormData(p => ({...p, kitchenHardware: e.target.value}))}>
                                            <option value="표준">표준 사양(국산)</option>
                                            <option value="고급">고급 사양(Blum)</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="font-sans">
                                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest border-b pb-2 mb-4">Countertop 상판</p>
                                    <select className="w-full p-3 bg-white border-2 border-teal-100 rounded-xl text-xs font-black outline-none text-teal-700 font-bold mb-3" value={formData.kitchenCountertop} onChange={(e) => setFormData(p => ({...p, kitchenCountertop: e.target.value}))}>
                                        <option value="인조대리석">인조대리석 (표준)</option><option value="엔지니어드스톤">엔지니어드스톤 (고급)</option><option value="세라믹">세라믹 (프리미엄)</option>
                                    </select>
                                    <input type="text" placeholder="추가 사항(정수기 위치 등)" className="w-full p-3 bg-slate-50 rounded-xl text-xs font-medium font-bold border-0 outline-none" value={formData.kitchenExtra} name="kitchenExtra" onChange={handleInputChange} />
                                </div>
                            </div>
                        </div>

                        <section className="bg-white p-8 md:p-12 rounded-[3.5rem] shadow-sm border-l-[14px] border-amber-500 relative section-break">
                            {(() => {
                                const activeFinishes = formData.finishesBySpace[formData.activeFinishSpace] || {
                                    floor: '미선택',
                                    floorOption: '미선택',
                                    wall: '미선택',
                                    wallpaperTypeWall: '미선택',
                                    wallpaperTypeCeiling: '미선택',
                                    ceiling: '미선택'
                                };
                                
                                return (
                                    <>
                                        <div className="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-10 gap-8">
                                            <div className="flex items-center gap-5">
                                                <div className="w-14 h-14 bg-amber-500 rounded-[1.5rem] flex items-center justify-center text-white shadow-xl shadow-amber-100">
                                                    <Layers size={28} />
                                                </div>
                                                <div>
                                                    <h3 className="text-2xl font-black text-slate-900 tracking-tight mb-1">마감재 사양</h3>
                                                    <div className="flex items-center gap-2">
                                                        <span className="px-2 py-0.5 bg-amber-100 text-amber-600 rounded-md text-[9px] font-black uppercase tracking-tighter">Space Selection</span>
                                                        <p className="text-[11px] font-bold text-slate-400">공간별 상세 자재를 선택하세요</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="flex flex-wrap gap-1.5 bg-slate-50 p-2 rounded-[1.5rem] border border-slate-100 print:hidden">
                                                {SPACES.map(s => {
                                                    const finishes = formData.finishesBySpace[s] || {};
                                                    const count = Object.values(finishes).filter(v => v && v !== '미선택').length;
                                                    return (
                                                        <button 
                                                            key={s} 
                                                            onClick={() => setFormData(p => ({...p, activeFinishSpace: s}))}
                                                            className={`px-5 py-2.5 rounded-2xl text-[11px] font-black transition-all ${formData.activeFinishSpace === s ? 'bg-amber-500 text-white shadow-lg shadow-amber-100 scale-105' : 'text-slate-400 hover:text-slate-600 hover:bg-slate-200/50'}`}
                                                        >
                                                            {s} {count > 0 && <span className="ml-1 opacity-70">({count})</span>}
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                            <FinishItem 
                                                type="floor"
                                                title="바닥재 (Floor)"
                                                icon="layout"
                                                value={activeFinishes.floor}
                                                options={['미선택', '장판', '강마루', '원목마루', '타일', '도장']}
                                                detailKey="floorOption"
                                                detailValue={activeFinishes.floorOption}
                                                detailOptions={[]}
                                                onMainChange={(val) => handleFinishChange('floor', val)}
                                                onDetailChange={(val) => handleFinishChange('floorOption', val)}
                                                activeFinishes={activeFinishes}
                                            />
                                            <FinishItem 
                                                type="wall"
                                                title="벽체 마감 (Wall)"
                                                icon="columns"
                                                value={activeFinishes.wall}
                                                options={['미선택', '벽지', '도장', '필름', '디자인월']}
                                                detailKey="wallpaperTypeWall"
                                                detailValue={activeFinishes.wallpaperTypeWall}
                                                detailOptions={WALLPAPER_TYPES}
                                                onMainChange={(val) => handleFinishChange('wall', val)}
                                                onDetailChange={(val) => handleFinishChange('wallpaperTypeWall', val)}
                                                activeFinishes={activeFinishes}
                                            />
                                            <FinishItem 
                                                type="ceiling"
                                                title="천장 마감 (Ceiling)"
                                                icon="maximize"
                                                value={activeFinishes.ceiling}
                                                options={['미선택', '벽지', '도장', '필름']}
                                                detailKey="wallpaperTypeCeiling"
                                                detailValue={activeFinishes.wallpaperTypeCeiling}
                                                detailOptions={WALLPAPER_TYPES}
                                                onMainChange={(val) => handleFinishChange('ceiling', val)}
                                                onDetailChange={(val) => handleFinishChange('wallpaperTypeCeiling', val)}
                                                activeFinishes={activeFinishes}
                                            />
                                        </div>
                                    </>
                                );
                            })()}
                        </section>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6 font-bold section-break">
                            {renderBathSection('publicBath', '공용 욕실 (Public)', 'bg-indigo-50/40', 'border-indigo-100', 'text-indigo-700')}
                            {renderBathSection('masterBath', '부부 욕실 (Master)', 'bg-purple-50/40', 'border-purple-100', 'text-purple-700')}
                        </div>

                        <section className="bg-white p-6 md:p-8 rounded-[2.5rem] shadow-sm border-l-8 border-emerald-500 font-bold section-break">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                                <h3 className="font-black text-emerald-600 text-xl flex items-center gap-2"><Box size={24} /> 가구 및 수납 계획</h3>
                                <div className="flex flex-wrap gap-1.5 print:hidden">
                                    {Object.keys(formData.furnitureBySpace).map(space => {
                                        const count = formData.furnitureBySpace[space].length;
                                        return (
                                            <button key={space} onClick={() => setFormData(p => ({...p, activeSpace: space}))} className={`px-4 py-1.5 rounded-full text-[11px] font-black transition-all border font-sans font-bold ${formData.activeSpace === space ? 'bg-emerald-500 border-emerald-500 text-white shadow-md' : 'bg-slate-100 text-slate-400 hover:border-emerald-200'}`}>
                                                {space} {count > 0 && <span className="ml-1 opacity-70">({count})</span>}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                                <div className="bg-slate-50/50 p-6 rounded-[2rem] border-2 border-slate-50 font-bold">
                                    <div className="flex items-center gap-3 mb-6">
                                        <div className="w-10 h-10 bg-emerald-100 rounded-2xl flex items-center justify-center text-emerald-600 font-black text-sm font-sans">{formData.activeSpace.slice(0,2)}</div>
                                        <div><p className="text-[10px] text-slate-400 font-black uppercase leading-none mb-1 font-sans">Unit</p><p className="text-lg font-black text-slate-800 tracking-tighter font-sans">{formData.activeSpace} 빌트인 가구</p></div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-3 font-bold">
                                        {['붙박이장', '화장대', '신발장', '팬트리', '키큰장', '펜트리장', '오픈 수납장'].map(item => (
                                            <label key={item} className={`flex items-center gap-3 p-3.5 rounded-2xl border-2 transition-all cursor-pointer font-sans ${formData.furnitureBySpace[formData.activeSpace].includes(item) ? 'bg-emerald-500 border-emerald-500 text-white shadow-lg font-sans font-bold' : 'bg-white border-slate-100 text-slate-400 hover:border-emerald-100 font-sans'}`}><input type="checkbox" className="hidden" checked={formData.furnitureBySpace[formData.activeSpace].includes(item)} onChange={() => toggleFurnitureForSpace(item)} /><span className="text-xs font-black font-sans font-bold">{item}</span></label>
                                        ))}
                                    </div>
                                </div>
                                <div className="space-y-6">
                                    <div className="hidden print:block mb-4 space-y-2 font-bold font-sans">
                                        <p className="text-xs font-black text-slate-400 border-b pb-1 mb-2 tracking-widest uppercase">Summary</p>
                                        {Object.entries(formData.furnitureBySpace).map(([space, items]) => items.length > 0 && (
                                            <div key={space} className="flex gap-2 items-center text-xs"><span className="font-black text-emerald-600">[{space}]</span> <span className="font-medium text-slate-600 italic font-sans">{items.join(', ')}</span></div>
                                        ))}
                                    </div>
                                    <textarea name="systemHangerInfo" value={formData.systemHangerInfo} onChange={handleInputChange} placeholder="시스템 행거 구성 및 가구 요청 사항" className="w-full p-5 bg-slate-50 border-2 border-transparent rounded-[1.5rem] h-28 focus:bg-white focus:border-emerald-400 outline-none text-sm font-medium font-sans font-bold" />
                                </div>
                            </div>
                        </section>

                        <section className="bg-white p-6 md:p-8 rounded-[2.5rem] shadow-sm border-t-8 border-rose-500 font-bold section-break">
                            <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
                                <h3 className="font-black text-rose-600 text-xl flex items-center gap-2"><Zap size={24} /> 전기 및 목공 디테일</h3>
                                <div className="flex flex-wrap gap-1.5 print:hidden">
                                    {Object.keys(formData.detailsBySpace).map(space => {
                                        const detail = formData.detailsBySpace[space];
                                        const count = (detail.lighting?.length || 0) + (detail.electrical?.length || 0) + (detail.carpentry?.length || 0);
                                        return (
                                            <button key={space} onClick={() => setFormData(p => ({...p, activeDetailSpace: space}))} className={`px-4 py-1.5 rounded-full text-[11px] font-black transition-all border font-sans font-bold ${formData.activeDetailSpace === space ? 'bg-rose-500 text-white border-rose-500 shadow-md' : 'bg-slate-100 text-slate-400 hover:border-rose-200'}`}>
                                                {space} {count > 0 && <span className="ml-1 opacity-70">({count})</span>}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            {(() => {
                                const currentDoorDetails = formData.doorDetailsBySpace[formData.activeDetailSpace] || {
                                    doorStyle: '미선택',
                                    doorHandle: '일반',
                                    moldingType: '미선택',
                                    skirtingType: '미선택',
                                    entranceDoor: '미선택'
                                };

                                const handleDoorDetailChange = (key, value) => {
                                    setFormData(prev => {
                                        const currentSpace = prev.doorDetailsBySpace[prev.activeDetailSpace] || {
                                            doorStyle: '미선택',
                                            doorHandle: '일반',
                                            moldingType: '미선택',
                                            skirtingType: '미선택',
                                            entranceDoor: '미선택'
                                        };
                                        
                                        return {
                                            ...prev,
                                            doorDetailsBySpace: {
                                                ...prev.doorDetailsBySpace,
                                                [prev.activeDetailSpace]: {
                                                    ...currentSpace,
                                                    [key]: value
                                                }
                                            }
                                        };
                                    });
                                };

                                return (
                                    <div className="bg-slate-50/50 p-6 md:p-8 rounded-[2.5rem] border-2 border-slate-100 relative shadow-sm mb-10 font-bold">
                                    <div className="absolute top-6 right-8 opacity-10 flex items-center gap-2 text-rose-300 font-bold"><Layout size={40}/><span className="text-2xl font-black uppercase font-sans">{formData.activeDetailSpace}</span></div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8 relative">
                                        <div>
                                            <h4 className="text-[11px] font-black text-slate-800 mb-5 flex items-center gap-2 font-sans font-bold"><Lightbulb size={16} className="text-orange-400"/> 공간 조명</h4>
                                            <div className="space-y-3.5 font-bold">
                                                {['메인등', '매립등(다운)', '간접 조명', '라인 조명', '실링팬'].map(light => (
                                                    <div key={light} className="flex flex-col gap-2 font-bold">
                                                        <label className="flex items-center gap-3 cursor-pointer group font-bold">
                                                            <div className={`w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all ${(formData.detailsBySpace[formData.activeDetailSpace]?.lighting || []).includes(light) ? 'bg-orange-400 border-orange-400 shadow-md' : 'bg-white border-slate-200'}`}>
                                                                {(formData.detailsBySpace[formData.activeDetailSpace]?.lighting || []).includes(light) && <Zap size={10} className="text-white fill-current"/>}
                                                            </div>
                                                            <input type="checkbox" className="hidden" checked={(formData.detailsBySpace[formData.activeDetailSpace]?.lighting || []).includes(light)} onChange={() => toggleDetailForSpace('lighting', light)}/>
                                                            <span className={`text-[12px] font-black ${(formData.detailsBySpace[formData.activeDetailSpace]?.lighting || []).includes(light) ? 'text-slate-800' : 'text-slate-400'}`}>{light}</span>
                                                        </label>
                                                        {(formData.detailsBySpace[formData.activeDetailSpace]?.lighting || []).includes(light) && (
                                                            <div className="pl-8">
                                                                <input type="text" placeholder="위치 상세" className="w-full p-2 text-[10px] bg-white border-b-2 border-orange-100 focus:border-orange-300 outline-none font-bold rounded-t-lg transition-all" value={(formData.detailsBySpace[formData.activeDetailSpace]?.lightingLocations || {})[light] || ''} onChange={(e) => handleDetailLocationChange(light, e.target.value)} />
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="text-[11px] font-black text-slate-800 mb-5 flex items-center gap-2 font-sans font-bold"><Cpu size={16} className="text-teal-500"/> 공간 전기 & 제어</h4>
                                            <div className="space-y-3 font-bold">
                                                {['분전함 교체', '단독 배선', '일괄소등 스위치', 'IoT 시스템 적용'].map(item => (
                                                    <label key={item} className={`flex items-center gap-3 p-3 rounded-2xl border-2 transition-all cursor-pointer font-bold ${(formData.detailsBySpace[formData.activeDetailSpace]?.electrical || []).includes(item) ? 'bg-teal-500 border-teal-500 text-white shadow-lg' : 'bg-white border-slate-100 text-slate-400 hover:border-teal-100'}`}>
                                                        <input type="checkbox" className="hidden" checked={(formData.detailsBySpace[formData.activeDetailSpace]?.electrical || []).includes(item)} onChange={() => toggleDetailForSpace('electrical', item)} />
                                                        <span className="text-[11px] font-black">{item}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="text-[11px] font-black text-slate-800 mb-5 flex items-center gap-2 font-sans font-bold"><Hammer size={16} className="text-blue-400"/> 공간 목공 & 특수</h4>
                                            <div className="grid grid-cols-1 gap-2.5 font-bold">
                                                {['천장 평탄화', '가벽설치', '단열공사', '문틀보강', '커튼박스', '웨인스코팅', '아치형 개구부'].map(item => (
                                                    <label key={item} className={`flex items-center gap-3 p-3 rounded-2xl border-2 transition-all cursor-pointer font-bold ${(formData.detailsBySpace[formData.activeDetailSpace]?.carpentry || []).includes(item) ? 'bg-blue-500 border-blue-500 text-white shadow-lg' : 'bg-white border-slate-100 text-slate-400 hover:border-blue-100'}`}><input type="checkbox" className="hidden" checked={(formData.detailsBySpace[formData.activeDetailSpace]?.carpentry || []).includes(item)} onChange={() => toggleDetailForSpace('carpentry', item)} /><span className="text-[11px] font-black">{item}</span></label>
                                                ))}
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="text-[11px] font-black text-slate-800 mb-5 flex items-center gap-2 font-sans font-bold"><Box size={16} className="text-purple-400"/> 방문 및 문선</h4>
                                            <div className="space-y-4 font-bold">
                                                <div>
                                                    <label className="text-[9px] font-black text-slate-400 uppercase mb-2 block">문선 선택</label>
                                                    <select className="w-full p-2.5 bg-white border-2 border-slate-100 rounded-xl outline-none text-xs font-black focus:border-purple-400 transition-colors" value={currentDoorDetails.doorStyle} onChange={(e) => handleDoorDetailChange('doorStyle', e.target.value)}>
                                                        <option value="미선택">미선택</option>
                                                        <option value="일반문">일반문</option>
                                                        <option value="9mm 문선">9mm 문선</option>
                                                        <option value="히든 도어">히든 도어</option>
                                                        <option value="무문선">무문선</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="text-[9px] font-black text-slate-400 uppercase mb-2 block">도어손잡이</label>
                                                    <div className="flex gap-2">
                                                        {['일반', '고급(도무스)'].map(h => (
                                                            <button key={h} onClick={() => handleDoorDetailChange('doorHandle', h)} className={`flex-1 py-2.5 text-[10px] font-black border-2 rounded-xl transition-all ${currentDoorDetails.doorHandle === h ? 'bg-purple-500 text-white border-purple-500 shadow-sm' : 'bg-white text-slate-400 border-slate-100 hover:border-purple-200'}`}>
                                                                {h}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="text-[11px] font-black text-slate-800 mb-5 flex items-center gap-2 font-sans font-bold"><Scissors size={16} className="text-amber-400"/> 목공 마감</h4>
                                            <div className="space-y-4 font-bold">
                                                <div>
                                                    <label className="text-[9px] font-black text-slate-400 uppercase mb-2 block">몰딩 선택</label>
                                                    <select className="w-full p-2.5 bg-white border-2 border-slate-100 rounded-xl outline-none text-xs font-black focus:border-amber-400 transition-colors" value={currentDoorDetails.moldingType} onChange={(e) => handleDoorDetailChange('moldingType', e.target.value)}>
                                                        <option value="미선택">미선택</option>
                                                        <option value="무몰딩">무몰딩</option>
                                                        <option value="마이너스몰딩">마이너스몰딩</option>
                                                        <option value="일반몰딩">일반몰딩</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="text-[9px] font-black text-slate-400 uppercase mb-2 block">걸레받이 선택</label>
                                                    <select className="w-full p-2.5 bg-white border-2 border-slate-100 rounded-xl outline-none text-xs font-black focus:border-amber-400 transition-colors" value={currentDoorDetails.skirtingType} onChange={(e) => handleDoorDetailChange('skirtingType', e.target.value)}>
                                                        <option value="미선택">미선택</option>
                                                        <option value="무걸레받이">무걸레받이</option>
                                                        <option value="마이너스 걸레받이">마이너스 걸레받이</option>
                                                        <option value="일반 걸레받이">일반 걸레받이</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <h4 className="text-[11px] font-black text-slate-800 mb-5 flex items-center gap-2 font-sans font-bold"><Box size={16} className="text-rose-400"/> 현관 중문</h4>
                                            <div className="font-bold">
                                                <select className="w-full p-3 bg-white border-2 border-rose-100 rounded-xl outline-none text-xs font-black text-rose-700 focus:border-rose-400 transition-colors" value={currentDoorDetails.entranceDoor} onChange={(e) => handleDoorDetailChange('entranceDoor', e.target.value)}>
                                                    <option value="미선택">미선택</option>
                                                    <option value="초슬림 3연동">초슬림 3연동</option>
                                                    <option value="원슬라이딩">원슬라이딩</option>
                                                    <option value="비대칭 여닫이">비대칭 여닫이</option>
                                                    <option value="스윙도어">스윙도어</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="hidden print:block mt-8 pt-6 border-t-2 border-slate-200 space-y-4 font-sans font-bold font-bold">
                                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest italic border-b pb-1 mb-3">Electrical & Carpentry Summary</p>
                                        {Object.entries(formData.detailsBySpace).map(([space, data]) => (data.lighting.length > 0 || (data.electrical && data.electrical.length > 0) || data.carpentry.length > 0) && (
                                            <div key={space} className="grid grid-cols-4 gap-4 text-[10px] border-b border-slate-50 pb-2 font-sans font-bold font-sans font-bold">
                                                <div className="font-black text-rose-500 font-sans font-bold font-bold">[{space}]</div>
                                                <div className="col-span-3 space-y-1 font-sans font-bold font-bold">
                                                    {data.lighting.length > 0 && <div className="font-sans font-bold font-sans font-bold font-sans font-bold"><span className="font-bold text-orange-500 font-sans">[조명]</span> {data.lighting.map(l => `${l}${data.lightingLocations[l] ? `(${data.lightingLocations[l]})` : ''}`).join(', ')}</div>}
                                                    {data.electrical && data.electrical.length > 0 && <div className="font-sans font-bold font-sans font-bold font-sans font-bold"><span className="font-bold text-teal-600 font-sans">[전기]</span> {data.electrical.join(', ')}</div>}
                                                    {data.carpentry.length > 0 && <div className="font-sans font-bold font-sans font-bold font-sans font-bold"><span className="font-bold text-blue-500 font-sans">[목공]</span> {data.carpentry.join(', ')}</div>}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    </div>
                                );
                            })()}
                        </section>

                        <footer className="py-12 text-center text-slate-300 border-t border-slate-100 mt-12 font-bold font-sans font-bold">
                            <p className="text-xs font-black tracking-[0.4em] uppercase mb-2 font-bold">TOTODESIGN INTERIOR STUDIO</p>
                            <p className="text-[10px] font-bold font-bold">본 시트는 상담 가이드용이며, 상세 내역은 확정 도면 및 견적서를 기준으로 합니다.</p>
                        </footer>
                    </div>
                    <button onClick={handlePrint} className="fixed bottom-6 right-6 bg-slate-900 text-white p-4 rounded-full shadow-2xl md:hidden hover:scale-110 active:scale-95 transition-all print:hidden z-50 font-bold font-sans font-bold"><Save size={24} /></button>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
